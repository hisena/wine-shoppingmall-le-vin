<meta charset="utf-8">
<!-- 커스텀 css -->
<link rel="stylesheet" href="css/custom/login_register.css">

<!-- 로그인, 회원가입 -->
<div class="htc__login__register bg__white ptb--130" style="background: rgba(0, 0, 0, 0) url(images/bg/5.jpg) no-repeat scroll center center / cover ;">
  <div class="container">
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <ul class="login__register__menu" role="tablist">
          <li role="presentation" class="login active"><a href="components/user/login.html" role="tab">로그인</a></li>
          <li role="presentation" class="register"><a href="components/user/register.html" role="tab">회원가입</a></li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 col-md-offset-3">
        <div class="htc__login__register__wrap">
          <div role="tabpanel" class="single__tabs__panel tab-pane fade in active">
            <!-- 동적으로 내용이 바뀌는 부분 -->
            <form class="login"></form>
          </div>                               
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JS 파일 -->
<!-- Daum Api -->
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
<script src="js/custom/daumApi.js"></script>
<!-- Timer.js -->
<script src="js/custom/timer.js"></script>
<!-- 공통 함수 -->
<script type="text/javascript" src="js/common/Utils.js"></script>
<script type="text/javascript" src="js/common/Validation.js"></script>
<!-- 로그인 Ajax -->
<script type="text/javascript">
var baseUrl = 'http://localhost:80/';
function toggleTabClass() {
	$('li.login').toggleClass('active');
	$('li.register').toggleClass('active');
}
$(function() {
	// 처음 실행 시에는 로그인 화면을 보여줌
	$('form.login').load('components/user/login.html');
	
	// 탭의 CSS를 이벤트에 알맞게 바꿔줌
	$(document).on("click", "li.login, li.register", function () {
		toggleTabClass();
    });
	
	// 화면을 탭에 따라 전환해주는 이벤트 등록
	$(document).on('click', 'a[role="tab"]', function(event){
		
		// 기본 이벤트 실행을 방지
		event.preventDefault();
		
		var fileToLoad = $(this).attr('href');
		$('form.login').load(fileToLoad);
	
	});
	
	/**
	 * 로그인 양식의 유효성 검사를 하는 자바 스크립트 파일
	 */
	var loginFormRequiredValidations = [
		Validation.isValidEmail,
		Validation.isValidPassword,
	];
	
	$("#login form").submit(function(event) {
		event.preventDefault();
		
		var validationResult = Validation.validAllInputs(loginFormRequiredValidations);
		
		if(!validationResult) {
			return false;
		}
		
		var data = $(this).serialize();
		
		$.ajax(baseUrl + "le-vin/user/login.mall", {
			data: data,
			dataType: "json",
			success: function(data) {
				setCookie('email', data.email, 1);
			},
			error: function(data) {
				console.log(data);
				alert('에러발생');
			}
		});
		
		return false;
	});
	
});

// 쿠키 생성
function setCookie(cname,cvalue,exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires=" + d.toGMTString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}
</script>