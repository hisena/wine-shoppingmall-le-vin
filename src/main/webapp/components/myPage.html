<meta charset="utf-8">
<!-- 커스텀 css -->
<link rel="stylesheet" href="css/custom/myPage.css">
<link rel="stylesheet" href="css/custom/pagination.css">

<!-- 메인사진 -->
<div class="ht__bradcaump__area" style="background: rgba(0, 0, 0, 0) url(images/bg/2.jpg) no-repeat scroll center center / cover ;">
  <div class="ht__bradcaump__wrap">
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <div class="bradcaump__inner text-center">
            <h2 class="bradcaump-title">마이페이지</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  
<!-- 회원정보 수정 -->
<section class="our-checkout-area ptb--120 bg__white">
  <div class="container">
    <div class="row">
      <div class="col-md-12 col-lg-12">
        <div class="ckeckout-left-sidebar">
          <!-- 주문자 정보 -->
          <div class="checkout-form">
            <h2 class="section-title-3">회원 정보 수정</h2>
            <div class="checkout-form-inner">
              <div class="single-checkout-box">
                <input type="text" placeholder="이름">
              </div>
              <div class="single-checkout-box">
                <input type="text" placeholder="새 비밀번호">
                <input type="text" placeholder="새 비밀번호 확인">
              </div>
              <div class="single-checkout-box">
                <input type="text" placeholder="휴대폰 번호">
              </div>
              <div class="wc-proceed-to-checkout" style="clear: right;">
                <a href="checkout.html">회원 정보 수정하기</a>
              </div>
            </div>
          </div>
          <!-- 배송지 목록 -->
          <div class="payment-form">
            <h2 class="section-title-3">배송지 관리</h2>
            <div class="single-checkout-box">
                <input type="text" id="postcode" name="zipCode" placeholder="우편번호" readonly>
                <input type="button" onclick="execDaumPostcode()" id="postFinder"
                  value="우편번호 찾기">
            </div>
            <div class="single-checkout-box">
              <input type="text" id="address" name="address" placeholder="주소" readonly>
              <input type="text" id="address2" name="detailedAddress" placeholder="상세주소">
            </div>
            <div class="wc-proceed-to-checkout" style="clear: right;">
                <a id="addDelivery">신규 배송지 추가</a>
            </div>
            <div class="checkout-form-inner delivery-wrapper">
              <div class="table-content table-responsive">
                <table>
                  <thead>
                    <tr>
                      <th>우편번호</th>
                      <th>주소</th>
                      <th>상세주소</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- 동적으로 내용이 생성되는 영역 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- 주문 목록 -->
          <div class="payment-form">
            <h2 class="section-title-3">주문 목록</h2>
            <div class="checkout-form-inner order-wrapper">
              <div class="table-content table-responsive">
                <table>
                  <thead>
                    <tr>
                      <th>주문 번호</th>
                  	  <th>총 주문 금액</th>
                  	  <th>주문일</th>
                  	  <th>결제 완료 여부</th>
                  	  <th>주문상태</th>
                  	</tr>
                  </thead>
                  <tbody>
                    <!-- 동적으로 내용이 생성되는 영역 -->
                  </tbody>
                </table>
          	  </div>
            </div>
            <!-- 페이지네이션 -->
            <div class="row mt--60">
              <div class="col-md-12">
                <ul class="pagination pagination-lg">
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div id="snackbar"></div>

<!-- 유효성 검사를 위한 자바스크립트 코드 -->
<script src="js/common/Validation.js"></script>
<!-- Daum Api -->
<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js"></script>
<script src="js/custom/daumApi.js"></script>
<!-- 주문 목록 페이지네이션을 위한 자바스크립트 코드 -->
<script src="js/common/pagination.js"></script>
<!-- 주문 목록을 불러오기 위한 자바스크립트 코드 -->
<script src="js/custom/myPageOrder.js"></script>
<!-- 배송지 연결을 위한 자바스크립트 코드 -->
<script src="js/custom/myPageDelivery.js"></script>
<script>
//이벤트 등록
$(function(){
    // 페이지 로딩 시 배송지 목록
    getDeliveryList();
    // 페이지 로딩 시 주문 목록
	getOrderList(1);
    
    // 페이지네이션 주문 목록
    $('.pagination-lg').on('click', 'a', function(event){
    	event.preventDefault();
    	
    	var currentPage = $(this).attr('href');
    	getOrderList(currentPage);
    });
    
    // 주문 상세 보기
    $('.order-wrapper').on('click', 'tbody tr', function() {
    	
    	var orderId = $(this).find('td:first-child').html();
    	getOrderDetail(orderId);
    });
    
    // 신규 배송지 추가
    $('#addDelivery').click(function(){
	 	// 유효성 검사
		var validationResult = Validation.validAllInputs([ 
			Validation.isZipCodeAndAddressEntered,
			Validation.isDetailedAddressEntered,
		]);
		if (!validationResult) {
			return;
		}
		
		var message = '배송지 추가에 실패하셨습니다. 다시 한 번 시도해주세요.';
		// 데이터 직렬화
		var data = {
			'email' : getCookie('email'),
			'zipCode' : $('#postcode').val(),
			'address' : $('#address').val(),
			'detailedAddress' : $('#address2').val()
		};
		
		// 통신 
		$.ajax(Utils.baseUrl + 'user/address-info-add.mall', {
			data: data,
			dataType: "JSON",
			method: "POST",
			success: function(data) {
				var result = data.addAddressResult === 'true';
				
				if (result) {
					
					getDeliveryList();
					message = '성공적으로 배송지를 추가했습니다.'
					$('#postcode').val(''),
					$('#address').val(''),
					$('#address2').val('')
				} 
				snackbar(message);
			},
			error: function(error) {
				if (error.status === 400) {
					message = '입력 값을 확인해주세요.';
				} else if (error.status === 412) {
					message = '이미 등록된 배송지입니다.';	
				}
				snackbar(message);
			}
		});
			
    });

});
</script>