<meta charset="utf-8">
<form id="findPasswordForm" class="login">
  <input type="email" placeholder="이메일">
  <input type="text" placeholder="인증번호" style="display: none;">
  <input type="password" placeholder="새로운 비밀번호" style="display: none;">
  <div class="tabs__checkbox" style="display: none;">
    <span class="countTimeMinute"></span>분 
    <span class="countTimeSecond"></span>초
  </div>
  <input type="button" value="비밀번호 찾기" id="findPwButton">
</form>

<script>
$(document).on('click', '#findPwButton', function() {
	// 타이머 설정
	clock(3,0, function() {
		$('input[type=text]').css("display", "none");
		$('input[type=password]').css("display", "none");
		$('.tabs__checkbox').css("display", "none");
		snackbar('인증번호 입력 시간이 초과했습니다.');
	})
	// 인증번호 받기 Ajax
	$.ajax(Utils.baseUrl + "user/validation-number-generate.mall", {
		method: "post",
		dataType: "json",
		data: {
			"email": $('input[type=email]').val()
		},
		success: function(data) {
			if (data.addAddressResult) {
				$('input[type=text]').css("display", "block");
				$('input[type=password]').css("display", "block");
				$('.tabs__checkbox').css("display", "block");
				$('#findPwButton').attr("value", "비밀번호 변경");
				$('#findPwButton').attr("id", "confirmPwButton");
			}
		},
		error: function(data) {
			snackbar('등록된 이메일이 아닙니다.');
		}
	});
});
$(document).on('click', '#confirmPwButton', function() {
	// 새로운 비밀번호 만들기 Ajax
	$.ajax(Utils.baseUrl + "user/password-find.mall", {
		method: "post",
		dataType: "json",
		data: {
			"email": $('input[type=email]').val(),
			"validation_number": $('input[type=text]').eq(1).val(),
			"password": $('input[type=password]').val()
		},
		success: function(data) {
			if (data.findPasswordResult) {
				$('#findPasswordForm').empty();
				$('#findPasswordForm').load('components/user/login.html');
			}
		},
		error: function(data) {
			snackbar('올바르지 않은 인증번호 입니다.');
		}
	});
});
</script>